<html>

  <head>
  	<!-- taking advantage of the fact that skalman has usable uglifyjs source files to use in his online wrapper for uglifyjs. Thank you! -->
  	<script src='https://skalman.github.io/UglifyJS-online/uglify/lib/minify.js'></script>
		<script src='https://skalman.github.io/UglifyJS-online/uglify/lib/utils.js'></script>
		<script src='https://skalman.github.io/UglifyJS-online/uglify/lib/ast.js'></script>
		<script src='https://skalman.github.io/UglifyJS-online/uglify/lib/parse.js'></script>
		<script src='https://skalman.github.io/UglifyJS-online/uglify/lib/transform.js'></script>
		<script src='https://skalman.github.io/UglifyJS-online/uglify/lib/scope.js'></script>
		<script src='https://skalman.github.io/UglifyJS-online/uglify/lib/output.js'></script>
		<script src='https://skalman.github.io/UglifyJS-online/uglify/lib/compress.js'></script>

		<script src='http://kangax.github.io/html-minifier/dist/htmlminifier.min.js'></script>
    <script>
      var html = js = css = ""
      var htmlMinify = require('html-minifier').minify;
      window.onload = x => {
        [1, 2, 3].forEach(filetype => {
          document.getElementById(filetype).addEventListener('change', getFile);
        })
      }

      function getFile(event) {
        const input = event.target
        if ('files' in input && input.files.length > 0) {
          readFileContent(input.files[0], input.value).then(setVariable)
        }
      }

      function setVariable(data) {
      	var content = data.content, filename = data.filename;
      	if (filename.endsWith('css') || filename.endsWith('html') || filename.endsWith('js')) {
					window[filename.split('.')[1]] = content;
          if (html != '' && (js != '' || location.href.toLowerCase().indexOf('nojs')!=-1) && (css != '' || location.href.toLowerCase().indexOf('nocss') != -1)) {
	        	js=minify(js,{parse:{bare_returns:!1,ecma:8,expression:!1,filename:null,html5_comments:!0,shebang:!0,strict:!1,toplevel:null},compress:{arrows:!0,booleans:!0,collapse_vars:!0,comparisons:!0,computed_props:!0,conditionals:!0,dead_code:!0,drop_console:!1,drop_debugger:!0,ecma:5,evaluate:!0,expression:!1,global_defs:{},hoist_funs:!1,hoist_props:!0,hoist_vars:!1,ie8:!1,if_return:!0,inline:!0,join_vars:!0,keep_classnames:!1,keep_fargs:!0,keep_fnames:!1,keep_infinity:!1,loops:!0,negate_iife:!0,passes:1,properties:!0,pure_getters:"strict",pure_funcs:null,reduce_funcs:!0,reduce_vars:!0,sequences:!0,side_effects:!0,switches:!0,top_retain:null,toplevel:!1,typeofs:!0,unsafe:!1,unsafe_arrows:!1,unsafe_comps:!1,unsafe_Function:!1,unsafe_math:!1,unsafe_methods:!1,unsafe_proto:!1,unsafe_regexp:!1,unsafe_undefined:!1,unused:!0,warnings:!1},mangle:{eval:!1,ie8:!1,keep_classnames:!1,keep_fnames:!1,properties:!1,reserved:[],safari10:!1,toplevel:!1},output:{ascii_only:!1,beautify:!1,bracketize:!1,comments:/@license|@preserve|^!/,ecma:5,ie8:!1,indent_level:4,indent_start:0,inline_script:!0,keep_quoted_props:!1,max_line_len:!1,preamble:null,preserve_line:!1,quote_keys:!1,quote_style:0,safari10:!1,semicolons:!0,shebang:!0,source_map:null,webkit:!1,width:80,wrap_iife:!1},wrap:!1}).code; // properties list = default for skalman's wrapper. (thanks!)
	          document.getElementById('result').value = htmlMinify(html.replace(/\<link rel=[\'\"]stylesheet[\'\"] href=[^\>]+\>/i, "<style>\n" + css + "\n</style\>").replace(/\<script src=[\"\']\w+\.js[\"\']\>\<\/script\>/i, "\<script>\n" + js + "\n\</script\>"), {caseSensitive: !1, collapseBooleanAttributes:!0,collapseInlineTagWhitespace:!1,collapseWhitespace:!0,conservativeCollapse:!1,decodeEntities:!0,html5:!0,includeAutoGeneratedTags:!1,keepClosingSlash:!1,minifyCSS:!0,minifyJS:!1,preserveLineBreaks:!1,preventAttributesEscaping:!1,processConditionalComments:!0,processScripts:["text/html"],quoteCharacter:"'",removeAttributeQuotes:!0,removeComments:!0,removeEmptyAttributes:!0,removeEmptyElements:!1,removeOptionalTags:!0,removeRedundantAttributes:!0,removeScriptTypeAttributes:!0,removeStyleLinkTypeAttributes:!0,removeTagWhitespace:!0,sortAttributes:!0,sortClassName:!0,trimCustomFragments:!0,useShortDoctype:!0}); // gently modified defaults for http://kangax.github.io/html-minifier/
        	}
        }
      }

      function readFileContent(file, filename) {
        const reader = new FileReader()
        return new Promise((resolve, reject) => {
          reader.onload = event => resolve({content: event.target.result, filename: filename})
          reader.onerror = error => reject(error)
          reader.readAsText(file)
        });
      }
    </script>
  </head>

  <body>
    <input type="file" id="1"><br>
    <input type="file" id="2"><br>
    <input type="file" id="3"><br>

    <textarea id="result"></textarea>
  </body>

</html>
